!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.TinyScrollListener=n()}(this,function(){"use strict";var o=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},t=function(){function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}}();var u=function(t){return"function"==typeof t},s="OUTSIDE",v="INSIDE",f="scroll",l=function(t){return u(t.distance)?t.distance():t.distance},d=function(n){var e=!1;return function(t){e||(requestAnimationFrame(function(){n(t),e=!1}),e=!0)}};return function(){function n(t){var a=this;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),this.config={},this.destroy=function(){return null},this.dynamicEvents=[],this.staticEvents=[],this.walkEvent=function(t,n){var e=t.onGoingIn,i=void 0===e?function(){}:e,r=t.onGoingOut,o=void 0===r?function(){}:r,c=t.status,a=l(t);switch(c){case v:a<n&&(o(),t.status=s);break;case s:n<=a&&(i(),t.status=v)}return t.status!==c},this.walkStaticEvent=function(t){var n=t.direction,e=t.scrollTop,i=a.currentStaticEvent,r=i.prevEvent||i.getPrevEvent(),o=i.nextEvent||i.getNextEvent(),c=1===n?i:r;c&&(a.walkEvent(c,e)&&(a.currentStaticEvent=(1===n?o:r)||i,a.walkStaticEvent({direction:n,scrollTop:e})))},this.walkDynamicEvents=function(t){var e=t.direction,n=t.scrollTop;a.dynamicEvents.sort(function(t,n){return(l(t)-l(n))*e}).forEach(function(t){a.walkEvent(t,n)})},this.config=t,this.init()}return t(n,[{key:"init",value:function(){var i=this,t=this.config,n=t.element,e=t.scrollHandler,r=void 0===e?d:e,o=t.getScrollTop;if(void 0!==n){var c=u(o)?o:function(){return n.scrollTop};if(this.getScrollTop=c,this.genDynamicEvents(),this.genStaticEvents(),0!==this.staticEvents.length||0!==this.dynamicEvents.length){var a=c(),s=r(function(t){t.stopPropagation();var n=c(),e={scrollTop:n,direction:a<n?1:-1};i.walkStaticEvent(e),i.walkDynamicEvents(e),a=n});return n.addEventListener(f,s),this.destroy=function(){return n.removeEventListener(f,s)},this}console.error("Need Events!")}else console.error("Need Scroll Container!")}},{key:"getEndReachedEvent",value:function(){var n=this,t=this.config,e=t.distanceToReachEnd,i=void 0===e?100:e,r=t.onEndReached,o=t.element;if(u(r)){var c=!1,a=function(t){t?0===n.staticEvents.length&&1===n.dynamicEvents.length&&n.dynamicEvents[0]===s&&n.destroy():c=!1},s={dynamic:!0,distance:function(){return o.scrollHeight-o.offsetHeight-i},onGoingOut:function(){c||(c=!0,r(a))}};return s}}},{key:"genDynamicEvents",value:function(){var t=this.config.distanceEvents,n=void 0===t?[]:t,e=this.getEndReachedEvent(),i=this.getScrollTop(),r=[].concat(function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)}(n),[e]).filter(function(t){return t&&t.dynamic&&u(t.distance)}).map(function(t){return o({},t,{status:i>t.distance?s:v})});this.dynamicEvents=r}},{key:"genStaticEvents",value:function(){var t=this.config.distanceEvents,n=void 0===t?[]:t,i=this.getScrollTop(),r=n.map(function(t){return o({},t,{distance:l(t)})}).filter(function(t){return 0<=t.distance&&!t.dynamic}).map(function(t,n){var e=o({},t,{status:i>t.distance?s:v,prevEvent:void 0,nextEvent:void 0,getPrevEvent:function(){var t=r[n-1]||null;return e.prevEvent=t},getNextEvent:function(){var t=r[n+1]||null;return e.nextEvent=t}});return e});this.staticEvents=r,this.currentStaticEvent=r.find(function(t){return t.distance>=i})}}]),n}()});
